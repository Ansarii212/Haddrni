<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>لوحة تحكم المشرف</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: 'Cairo', sans-serif; padding: 20px; background-color: #f5f5f5; direction: rtl; }
    input, button { padding: 10px; margin: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; background-color: #fff; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #eee; }
    .hidden { display: none; }
    .btn-print { margin: 10px 0; background: #2c3e50; color: white; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <h2>تسجيل دخول المشرف</h2>
  <input type="email" id="email" placeholder="البريد الإلكتروني">
  <input type="password" id="password" placeholder="كلمة المرور">
  <button onclick="login()">تسجيل الدخول</button>

  <div id="content" class="hidden">
    <h2>جدول الحضور</h2>
    <button class="btn-print" onclick="printTable('attendanceTable', 'جدول الحضور')">طباعة الحضور</button>
    <table id="attendanceTable">
      <thead>
        <tr>
          <th>الاسم</th><th>التاريخ</th><th>الحالة</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2>جدول المعلمين</h2>
    <button class="btn-print" onclick="printTable('teachersTable', 'جدول المعلمين')">طباعة المعلمين</button>
    <table id="teachersTable">
      <thead>
        <tr>
          <th>الاسم</th><th>البريد الإلكتروني</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // firebase config
    const firebaseConfig = {
      apiKey: "AIzaSy...",
      authDomain: "attendance-sheet-2025.firebaseapp.com",
      projectId: "attendance-sheet-2025",
      storageBucket: "attendance-sheet-2025.appspot.com",
      messagingSenderId: "73881...",
      appId: "1:73881...:web:8781..."
    };

    // init Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          const userId = userCredential.user.uid;
          document.getElementById("content").classList.remove("hidden");

          // جلب جدول الحضور
          db.collection("attendance").where("managerId", "==", userId)
            .get().then((querySnapshot) => {
              const table = document.querySelector("#attendanceTable tbody");
              table.innerHTML = "";
              querySnapshot.forEach((doc) => {
                const data = doc.data();
                table.innerHTML += `<tr>
                  <td>${data.name}</td>
                  <td>${data.date}</td>
                  <td>${data.status}</td>
                </tr>`;
              });
            });

          // جلب جدول المعلمين
          db.collection("teachers").where("managerId", "==", userId)
            .get().then((querySnapshot) => {
              const table = document.querySelector("#teachersTable tbody");
              table.innerHTML = "";
              querySnapshot.forEach((doc) => {
                const data = doc.data();
                table.innerHTML += `<tr>
                  <td>${data.name}</td>
                  <td>${data.email}</td>
                </tr>`;
              });
            });
        })
        .catch((error) => {
          alert("خطأ في تسجيل الدخول: " + error.message);
        });
    }

    function printTable(tableId, title) {
      const table = document.getElementById(tableId).outerHTML;
      const printWindow = window.open("", "_blank");
      printWindow.document.write(`
        <html>
        <head>
          <title>${title}</title>
          <style>
            body { font-family: 'Cairo', sans-serif; direction: rtl; padding: 20px; }
            table { width: 100%; border-collapse: collapse; }
            th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
            th { background: #eee; }
          </style>
        </head>
        <body>
          <h2>${title}</h2>
          ${table}
          <script>window.print();<\/script>
        </body>
        </html>
      `);
      printWindow.document.close();
    }
  </script>
</body>
</html>
